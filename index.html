<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Savia – Panel de negocios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="img/logo_transparent_background.png">

  <!-- Tipografías -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root{
      --verde-savia:#4BAF8C;
      --verde-oscuro:#145a4a;
      --verde-claro:#A7E3CF;
      --arena:#FFEFD9;
      --durazno:#FFCCB3;
      --fondo:#f4f6fb;
      --texto:#102a27;
      --texto-suave:#64748b;
      --card:#ffffff;
      --borde:#d1d5db;
    }

    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:"Poppins",system-ui,-apple-system,sans-serif;
      min-height:100vh;
      background:
        radial-gradient(circle at 0% 0%, #c4f3de 0, transparent 55%),
        radial-gradient(circle at 100% 100%, #ffd9bf 0, transparent 55%),
        linear-gradient(145deg,#fef6ec,#e5fff5);
      color:var(--texto);
      display:flex;
      justify-content:center;
      align-items:center;
      padding:18px 10px;
    }

    .shell{
      width:100%;
      max-width:1120px;
      background:rgba(255,255,255,.9);
      border-radius:28px;
      border:1px solid rgba(209,213,219,.8);
      box-shadow:0 26px 70px rgba(15,23,42,.18);
      padding:18px 18px 20px;
      display:grid;
      grid-template-columns:1.2fr 1.4fr;
      gap:18px;
    }

    /* HEADER */
    .header{
      grid-column:1 / -1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:6px;
    }

    .logo-row{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .logo-circle{
      width:46px;
      height:46px;
      border-radius:18px;
      background:radial-gradient(circle at 20% 0,#ffffff,#e0f7ec);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 12px 30px rgba(15,118,110,.35);
      overflow:hidden;
    }
    .logo-circle img{
      max-width:80%;
      height:auto;
      display:block;
    }

    .logo-text{
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .logo-text span{
      font-size:.7rem;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#6b7280;
    }

    .logo-text strong{
      font-family:"Cormorant Garamond",serif;
      font-size:1.5rem;
      letter-spacing:.2em;
      text-transform:uppercase;
      color:#145a4a;
    }

    .header-tag{
      font-size:.72rem;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(75,175,140,.08);
      color:#065f46;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .header-tag i{
      font-size:.8rem;
    }

    /* COLUMNA IZQUIERDA: hero + formulario */
    .left{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .hero-title{
      font-size:1.35rem;
      line-height:1.2;
      color:#022c22;
      margin-bottom:4px;
    }

    .hero-title span{
      color:var(--verde-savia);
    }

    .hero-text{
      font-size:.86rem;
      color:var(--texto-suave);
      margin-bottom:6px;
    }

    .hero-steps{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
    }

    .step-pill{
      font-size:.74rem;
      padding:4px 8px;
      border-radius:999px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
      display:inline-flex;
      align-items:center;
      gap:6px;
      color:#4b5563;
    }

    .step-pill span{
      width:18px;
      height:18px;
      border-radius:999px;
      background:#ecfdf5;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.72rem;
      color:#16a34a;
      font-weight:600;
    }

    .panel-form{
      margin-top:4px;
      background:#f9fafb;
      border-radius:16px;
      padding:10px 10px 11px;
      border:1px solid #e5e7eb;
      box-shadow:0 14px 32px rgba(148,163,184,.22);
      font-size:.78rem;
    }

    .panel-form h2{
      font-size:.95rem;
      margin-bottom:3px;
      color:#111827;
    }

    .panel-form p{
      font-size:.78rem;
      color:#6b7280;
      margin-bottom:8px;
    }

    .field-group{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-bottom:6px;
    }

    label{
      font-size:.74rem;
      color:#4b5563;
    }

    input, select{
      border-radius:10px;
      border:1px solid var(--borde);
      padding:6px 8px;
      font-size:.8rem;
      background:#ffffff;
      outline:none;
      font-family:inherit;
      transition:border-color .15s, box-shadow .15s, background .15s;
    }

    input:focus, select:focus{
      border-color:var(--verde-savia);
      box-shadow:0 0 0 1px rgba(74,222,128,.45);
      background:#f9fffd;
    }

    .grid-2{
      display:grid;
      grid-template-columns:1.1fr 1fr;
      gap:6px;
    }

    .btn-primary{
      margin-top:4px;
      width:100%;
      border:none;
      border-radius:999px;
      padding:8px 10px;
      font-size:.82rem;
      font-weight:500;
      cursor:pointer;
      color:#ffffff;
      background:linear-gradient(135deg,var(--verde-savia),var(--verde-oscuro));
      box-shadow:0 14px 32px rgba(15,118,110,.45);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }

    .btn-primary:hover{
      filter:brightness(1.05);
    }

    .tiny-note{
      font-size:.72rem;
      color:#9ca3af;
      margin-top:3px;
    }

    /* COLUMNA DERECHA: LISTA DE NEGOCIOS */
    .right{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .right-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .right-header h2{
      font-size:.95rem;
      color:#111827;
    }

    .right-header span{
      font-size:.75rem;
      color:#6b7280;
    }

    .negocios-list{
      margin-top:2px;
      display:grid;
      grid-template-columns:1fr;
      gap:8px;
      max-height:360px;
      overflow:auto;
      padding-right:4px;
    }

    .neg-card{
      border-radius:16px;
      padding:8px 9px;
      background:#ffffff;
      border:1px solid #e5e7eb;
      box-shadow:0 10px 24px rgba(148,163,184,.22);
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:.78rem;
      position:relative;
    }

    .neg-tag{
      position:absolute;
      top:8px;
      right:8px;
      font-size:.68rem;
      padding:3px 7px;
      border-radius:999px;
      background:#ecfdf5;
      color:#166534;
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    .neg-name{
      font-size:.9rem;
      font-weight:600;
      color:#022c22;
    }

    .neg-line{
      font-size:.76rem;
      color:#6b7280;
    }

    .neg-links{
      margin-top:4px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .neg-btn{
      border-radius:999px;
      border:1px solid #e5e7eb;
      padding:4px 9px;
      font-size:.72rem;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:5px;
      color:#374151;
      background:#f9fafb;
    }

    .neg-btn.primary{
      border-color:transparent;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#ffffff;
      box-shadow:0 10px 24px rgba(22,163,74,.55);
    }

    .neg-btn i{
      font-size:.8rem;
    }

    .sin-negocios{
      font-size:.78rem;
      color:#9ca3af;
      font-style:italic;
      padding:10px 4px;
    }

    @media (max-width:900px){
      .shell{
        grid-template-columns:1fr;
      }
      .negocios-list{
        max-height:260px;
      }
    }

    @media (max-width:600px){
      body{
        padding:12px 6px;
      }
      .shell{
        padding:14px 12px 16px;
        border-radius:22px;
      }
      .header{
        flex-direction:column;
        align-items:flex-start;
      }
      .grid-2{
        grid-template-columns:1fr;
      }
    }
  </style>
</head>
<body>

<div class="shell">

  <!-- HEADER -->
  <header class="header">
    <div class="logo-row">
      <div class="logo-circle">
        <img src="img/logo_transparent_background.png" alt="Savia">
      </div>
      <div class="logo-text">
        <span>Software & programación</span>
        <strong>SAVIA</strong>
      </div>
    </div>
    <div class="header-tag">
      <i class="fa-regular fa-circle-check"></i>
      Un panel para todos tus negocios
    </div>
  </header>

  <!-- IZQUIERDA -->
  <section class="left">
    <div>
      <h1 class="hero-title">
        Savia organiza tu tiempo,<br>
        <span>vos hacés crecer tu negocio.</span>
      </h1>
      <p class="hero-text">
        Desde este panel vas a administrar todas tus estéticas, consultorios o emprendimientos.
        Cada tarjeta es un negocio con su propio panel profesional y link de turnos para clientas.
      </p>
      <div class="hero-steps">
        <div class="step-pill"><span>1</span> Cargás tus datos</div>
        <div class="step-pill"><span>2</span> Compartís el link de turnos</div>
        <div class="step-pill"><span>3</span> Usás el panel día a día</div>
      </div>
    </div>

    <!-- FORM NUEVO NEGOCIO -->
    <div class="panel-form">
      <h2>Crear un nuevo negocio</h2>
      <p>Completá estos datos y Savia genera el panel y los links para este negocio.</p>

      <form id="form-negocio">
        <div class="field-group">
          <label for="neg-nombre">Nombre comercial</label>
          <input id="neg-nombre" type="text" placeholder="Ej: Estética Bellezza" required>
        </div>

        <div class="grid-2">
          <div class="field-group">
            <label for="neg-id">ID / dirección corta (sin espacios)</label>
            <input id="neg-id" type="text" placeholder="ej: bellezza" required>
          </div>
          <div class="field-group">
            <label for="neg-rubro">Rubro</label>
            <select id="neg-rubro">
              <option value="Estética · Uñas · Masajes">Estética · Uñas · Masajes</option>
              <option value="Consultorio psicológico">Consultorio psicológico</option>
              <option value="Peluquería y barbería">Peluquería y barbería</option>
              <option value="Bienestar & terapias">Bienestar & terapias</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div class="field-group">
            <label for="neg-whatsapp">WhatsApp del negocio</label>
            <input id="neg-whatsapp" type="tel" placeholder="Ej: 2613 38-7305">
          </div>
          <div class="field-group">
            <label for="neg-instagram">Instagram (usuario o link)</label>
            <input id="neg-instagram" type="text" placeholder="@mi_estetica">
          </div>
        </div>

        <div class="field-group">
          <label for="neg-color">Color principal (demo)</label>
          <input id="neg-color" type="color" value="#4BAF8C">
        </div>

        <button type="submit" class="btn-primary">
          <i class="fa-regular fa-square-plus"></i>
          Crear negocio en Savia
        </button>
      </form>

      <p class="tiny-note">
        En la versión real, estos datos se guardan en Firebase y los toman
        <strong>admin.html</strong> y <strong>turnos.html</strong> según el ID del negocio.
      </p>
    </div>
  </section>

  <!-- DERECHA -->
  <section class="right">
    <div class="right-header">
      <div>
        <h2>Mis negocios en Savia</h2>
        <span>Elegí uno para ver el panel profesional o el link de reservas.</span>
      </div>
    </div>

    <div id="negocios-list" class="negocios-list">
      <!-- tarjetas por JS -->
    </div>
  </section>

</div>

<!-- ============================= -->
<!--  FIREBASE + FIRESTORE (MÓDULO) -->
<!-- ============================= -->
<script type="module">
  // SDKs Firebase (versión 12.6.0)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    setDoc,
    serverTimestamp,
    onSnapshot,
    query,
    orderBy
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // Config de TU proyecto Savia
  const firebaseConfig = {
    apiKey: "AIzaSyBs3V8rJ6cKI08IADuzecAI9XUL3740Gb4",
    authDomain: "savia-74c89.firebaseapp.com",
    projectId: "savia-74c89",
    storageBucket: "savia-74c89.firebasestorage.app",
    messagingSenderId: "627564458830",
    appId: "1:627564458830:web:deb7ee624592236a91241f"
  };

  // Inicializar Firebase + Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Referencia a la colección de negocios
  const negociosCol = collection(db, "negocios");

  const form = document.getElementById("form-negocio");
  const list = document.getElementById("negocios-list");

  // Render de tarjetas
  function renderNegocioCard(id, data){
    const card = document.createElement("article");
    card.className = "neg-card";

    const color = data.colorPrincipal || "#4BAF8C";
    const rubro = data.rubro || "Rubro sin definir";
    const nombre = data.nombre || id;

    card.innerHTML = `
      <div class="neg-tag">ID: ${id}</div>
      <div class="neg-name">${nombre}</div>
      <div class="neg-line">${rubro}</div>
      <div class="neg-line" style="font-size:.74rem;">
        <strong>WhatsApp:</strong> ${data.whatsapp || "—"}
        &nbsp;·&nbsp;
        <strong>Instagram:</strong> ${data.instagram || "—"}
      </div>
      <div class="neg-links">
        <a href="admin.html?negocio=${encodeURIComponent(id)}" class="neg-btn primary">
          <i class="fa-regular fa-calendar-check"></i> Panel profesional
        </a>
        <a href="turnos.html?negocio=${encodeURIComponent(id)}" class="neg-btn">
          <i class="fa-solid fa-link"></i> Link para clientas
        </a>
      </div>
    `;

    // pequeño borde de color a la izquierda
    card.style.borderLeft = `4px solid ${color}`;

    list.appendChild(card);
  }

  // Escuchar en tiempo real la colección de negocios
  const q = query(negociosCol, orderBy("nombre"));

  onSnapshot(q, (snapshot)=>{
    list.innerHTML = "";
    if(snapshot.empty){
      const p = document.createElement("p");
      p.className = "sin-negocios";
      p.textContent = "Todavía no cargaste ningún negocio. Usá el formulario de la izquierda para crear el primero ✨";
      list.appendChild(p);
      return;
    }
    snapshot.forEach(docSnap=>{
      renderNegocioCard(docSnap.id, docSnap.data());
    });
  });

  // Alta de nuevo negocio
  form.addEventListener("submit", async (e)=>{
    e.preventDefault();

    const nombre = document.getElementById("neg-nombre").value.trim();
    let id = document.getElementById("neg-id").value.trim().toLowerCase();
    const rubro = document.getElementById("neg-rubro").value;
    const whatsapp = document.getElementById("neg-whatsapp").value.trim();
    const instagram = document.getElementById("neg-instagram").value.trim();
    const color = document.getElementById("neg-color").value || "#4BAF8C";

    if(!nombre || !id){
      alert("Completá al menos el nombre y el ID del negocio.");
      return;
    }

    // limpiar ID: sin espacios, solo letras/números/guiones
    id = id
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"") // saca tildes
      .replace(/\s+/g,"-")                              // espacios -> guiones
      .replace(/[^a-zA-Z0-9\-]/g,"")                    // solo letras/números/-
      .toLowerCase();

    if(!id){
      alert("El ID del negocio no es válido. Usá letras, números y guiones.");
      return;
    }

    const negocioDoc = doc(db, "negocios", id);

    const data = {
      nombre,
      slug:id,
      rubro,
      whatsapp,
      instagram,
      colorPrincipal:color,
      creadoEn: serverTimestamp()
    };

    try{
      await setDoc(negocioDoc, data, { merge:true });
      form.reset();
      document.getElementById("neg-color").value = color; // mantiene el color elegido
      alert("Negocio guardado en Savia. Ya podés entrar al panel o al link de turnos.");
    }catch(err){
      console.error(err);
      alert("Ocurrió un error al guardar el negocio. Revisá la consola del navegador.");
    }
  });
</script>

</body>
</html>
